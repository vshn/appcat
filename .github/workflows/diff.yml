name: Diff
on:
  workflow_run:
    workflows: ["PR Automation"]
    branches: ["*"]
    types:
      - completed

jobs:
  render-diff:
    runs-on: ubuntu-latest
    steps:
      - name: Extract branch name
        shell: bash
        run: echo "branch=${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}" >> $GITHUB_OUTPUT
        id: extract_branch

      - name: Trigger diff on internal gitalb
        run: |
          curl -X POST \
             --fail \
             -F token=${{ secrets.GITLAB_CI_TOKEN }} \
             -F ref=add/pipeline \
             -F "variables[BRANCH]=${{ steps.extract_branch.outputs.branch }}" \
             https://git.vshn.net/api/v4/projects/58084/trigger/pipeline
